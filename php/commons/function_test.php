<?php
require_once ROOT_PATH . '/commons/DateTimeHelper.php';
require_once ROOT_PATH . '/commons/UtilsHelper.php';
require_once ROOT_PATH . '/geoip/geoip2.phar';
use GeoIp2\Database\Reader;

/**
 * 日期时间函数测试
 */
function testDateTime()
{
    // 服务区时区
    echo DateTimeHelper::getDefaultTimezone();
    echo "\r\n";
    // 设置服务区时区
    DateTimeHelper::setDefaultTimezone('PRC');
    $dateStr = date('Y-m-d 00:00:00', strtotime('-6 month'));
    $timeStr = strtotime($dateStr);
    var_dump($timeStr, strtotime('-6 month')); exit;
}

/**
 * app请求签名测试
 */
function testGetSign()
{
    $params = [
        'version'  => 6,
        'module'   => 'captchaloging',
        'account'  => '15602961486',
        'password' => 'admin111',
        'ip'       => '172.21.21.21',
        'token'    => 'sdfasdfasf165a4sfd65a4sf6',
    ];
    $text = UtilsHelper::getSign($params);
    var_dump($params, $text);exit;
}

/**
 * 解析dubbo服务配置测试
 */
function testParseServiceConfig()
{
    $config = <<<str
{"providers":["hessian%3A%2F%2F10.130.71.2%3A10882%2Fcom.oneplus.user.api.UserFacade%3Fanyhost%3Dtrue%26application%3Duser-service%26bean.name%3Dcom.oneplus.user.api.UserFacade%26deprecated%3Dfalse%26dubbo%3D2.0.2%26dynamic%3Dtrue%26generic%3Dfalse%26group%3Din%26interface%3Dcom.oneplus.user.api.UserFacade%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CmodifyPassword%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CmodifyEmail%2CmodifyMobileInAllStatus%2CaddUser%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CunbindMobile%2CbindThirdUser%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D536%26release%3D2.7.4.1-SNAPSHOT%26retries%3D0%26revision%3D4.1.0-SNAPSHOT%26service.filter%3Ddefault%2ClogProviderFilter%2CsecurityProviderFilter%26side%3Dprovider%26timeout%3D60000%26timestamp%3D1618906425798%26version%3D4.0.0","hessian%3A%2F%2F10.130.117.12%3A10882%2Fcom.oneplus.user.api.UserFacade%3Fanyhost%3Dtrue%26application%3Duser-service%26bean.name%3Dcom.oneplus.user.api.UserFacade%26deprecated%3Dfalse%26dubbo%3D2.0.2%26dynamic%3Dtrue%26generic%3Dfalse%26group%3Dglobal%26interface%3Dcom.oneplus.user.api.UserFacade%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CmodifyPassword%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CmodifyEmail%2CmodifyMobileInAllStatus%2CaddUser%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CunbindMobile%2CbindThirdUser%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D31883%26release%3D2.7.4.1-SNAPSHOT%26retries%3D0%26revision%3D4.1.0-SNAPSHOT%26service.filter%3Ddefault%2ClogProviderFilter%2CsecurityProviderFilter%26side%3Dprovider%26timeout%3D60000%26timestamp%3D1619323371203%26version%3D4.0.0"],"consumers":["consumer%3A%2F%2F10.130.117.98%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dopen%26category%3Dconsumers%26check%3Dfalse%26default.reference.filter%3Ddefault%26default.timeout%3D60000%26dubbo%3D2.5.3.4%26interface%3Dcom.oneplus.user.api.UserFacade%26loadbalance%3Drandom%26methods%3DconfirmDeleteUserData%2CaddUserByMobileAndThirdParty%2CresetPasswordInAllStatus%2CaddUser%2CrecoverUser%2CgetThirdUser%2CmodifyEmailInAllStatus%2CgetUserAndThirdAccounts%2CactiveModifiedEmail%2CresetNewPassword%2CisUserExisted%2CmodifyUserStatusAndEmailStatus%2CrecoverAndLogin%2CmodifyEmailByPassword%2CbindThirdUser%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2CgetUserByAccount%2CgetUserByThirdParty%2CisUserExistedInAllStatus%2CunbindThirdUser%2CgetOrBindThirdUser%2CmodifyMobile%2CunbindMobile%2CmodifyMobileForced%2CmodifyMobileEmailPassowrd%2CmodifyMobileInAllStatus%2CresetPassword%2CgetOrAddGetUserByUnionType%2CbindThirdPartyToUserByPassprot%2CunbindUserFromThirdParty%2CauthenticatePassword%2CbindThirdPartyToUser%2CgetUserByEmail%2CdeactivatedUser%2ClistUserByUserIds%2CbatchAddUser%2CgetUserByMobile%2ClistUserIdByUserQuery%2CmodifyPassword%2CmodifyUserInAllStatus%2CmodifyIdentityInfo%2CauthenticatePasswordInAllStatus%2CconfirmUserOperation%2ClistDeactivatedUser%2CmodifyUser%2CqueryUserStatusByAccount%2CmodifyEmail%26owner%3Doneplus%26pid%3D14%26protocol%3Ddubbo%26revision%3D4.0.32%26side%3Dconsumer%26timestamp%3D1617247061363%26version%3D4.0.0","consumer%3A%2F%2F10.130.71.67%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dsales-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DunbindThirdUser%2CresetPassword%2CauthenticatePasswordInAllStatus%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CmodifyPassword%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CbindThirdPartyToUserByPassprot%2CactiveModifiedEmail%2CgetOrBindThirdUser%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CbatchAddUser%2CaddUserByMobileAndThirdParty%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CbindThirdUser%2CunbindMobile%2ClistUserByUserIds%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2ClistDeactivatedUser%2CbindThirdPartyToUser%2CmodifyMobile%2CauthenticatePassword%2CmodifyIdentityInfo%2CmodifyEmailByPassword%2CmodifyUserStatusAndEmailStatus%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D115288%26protocol%3Ddubbo%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1%26revision%3D4.0.8%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619335073028%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.14%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dtradecenter-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DunbindThirdUser%2CresetPassword%2CauthenticatePasswordInAllStatus%2CgetUserByThirdParty%2CmodifyMobileEmailPassowrd%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyMobileInAllStatus%2CaddUser%2CmodifyEmail%2CgetUserByAccount%2CbindThirdPartyToUserByPassprot%2CactiveModifiedEmail%2CgetOrBindThirdUser%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CbatchAddUser%2CaddUserByMobileAndThirdParty%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2CbindThirdUser%2CunbindMobile%2ClistUserByUserIds%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CrecoverAndLogin%2CbindThirdPartyToUser%2CauthenticatePassword%2CmodifyMobile%2CconfirmDeleteUserData%2CmodifyIdentityInfo%2CmodifyEmailByPassword%2CmodifyUserStatusAndEmailStatus%2CmodifyUserInAllStatus%2CresetNewPassword%26owner%3Doneplus%26pid%3D13%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1%26revision%3D4.0.27%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619333878835%26version%3D4.0.0","consumer%3A%2F%2F10.130.71.58%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dsales-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DunbindThirdUser%2CresetPassword%2CauthenticatePasswordInAllStatus%2CgetUserByThirdParty%2CmodifyPassword%2CmodifyMobileEmailPassowrd%2CgetOrAddGetUserByUnionType%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CbindThirdPartyToUserByPassprot%2CactiveModifiedEmail%2CgetOrBindThirdUser%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CbatchAddUser%2CaddUserByMobileAndThirdParty%2CmodifyEmailInAllStatus%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CdeactivatedUser%2CbindThirdUser%2CunbindMobile%2ClistUserByUserIds%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2ClistDeactivatedUser%2CbindThirdPartyToUser%2CmodifyMobile%2CauthenticatePassword%2CmodifyIdentityInfo%2CmodifyEmailByPassword%2CmodifyUserStatusAndEmailStatus%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D102655%26protocol%3Ddubbo%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1%26revision%3D4.0.8%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619334438638%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.7%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dpromotioncenter-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyMobileEmailPassowrd%2CaddUser%2CmodifyMobileInAllStatus%2CmodifyEmail%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CunbindMobile%2CbindThirdUser%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyIdentityInfo%2CmodifyUserStatusAndEmailStatus%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D12%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619158612508%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.26%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dpromotioncenter-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CmodifyPassword%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D13%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619158612472%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.11%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Daccountcenter%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CmodifyPassword%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D12%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%2C%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619336187533%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.92%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dsales-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CauthenticatePasswordInAllStatus%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyMobileEmailPassowrd%2CmodifyMobileInAllStatus%2CaddUser%2CmodifyEmail%2CbindThirdPartyToUserByPassprot%2CgetUserByAccount%2CactiveModifiedEmail%2CgetOrBindThirdUser%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CbatchAddUser%2CaddUserByMobileAndThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CunbindUserFromThirdParty%2CdeactivatedUser%2ClistUserByUserIds%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2ClistDeactivatedUser%2CbindThirdPartyToUser%2CauthenticatePassword%2CmodifyMobile%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyEmailByPassword%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D12%26protocol%3Ddubbo%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1%26revision%3D4.0.8%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1617247049445%26version%3D4.0.0","consumer%3A%2F%2F10.130.71.55%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dpromotioncenter-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyMobileEmailPassowrd%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D14%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619158557018%26version%3D4.0.0","consumer%3A%2F%2F10.130.117.17%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dlevin%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CmodifyMobileEmailPassowrd%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyEmail%2CmodifyMobileInAllStatus%2CaddUser%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CconfirmUserOperation%2CaddUserByCheckAllStatus%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D1940%26protocol%3Dhessian%26proxy%3DrouteJdk%26release%3D2.7.4.1%26revision%3D4.0.35%26side%3Dconsumer%26sticky%3Dfalse%26timestamp%3D1619322335118%26version%3D4.0.0","consumer%3A%2F%2F10.130.71.27%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Dpromotioncenter-service%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DresetPassword%2CunbindThirdUser%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyMobileEmailPassowrd%2CmodifyPassword%2CaddUser%2CmodifyMobileInAllStatus%2CmodifyEmail%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D13%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1619158561272%26version%3D4.0.0","consumer%3A%2F%2F10.130.71.22%2Fcom.oneplus.user.api.UserFacade%3Fapplication%3Daccountcenter%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26group%3D%2A%26interface%3Dcom.oneplus.user.api.UserFacade%26lazy%3Dfalse%26loadbalance%3Drandom%26methods%3DunbindThirdUser%2CresetPassword%2CgetUserByThirdParty%2CgetOrAddGetUserByUnionType%2CmodifyPassword%2CmodifyMobileEmailPassowrd%2CaddUser%2CmodifyEmail%2CmodifyMobileInAllStatus%2CgetUserByAccount%2CactiveModifiedEmail%2CisUserExisted%2CmodifyUser%2CgetThirdUser%2CaddUserByMobileAndThirdParty%2CbindThirdUser%2CunbindMobile%2CrecoverUser%2CmodifyMobileForced%2ClistUserIdByUserQuery%2CisUserExistedInAllStatus%2CrecoverAndLogin%2CbindThirdPartyToUser%2CmodifyMobile%2CmodifyEmailByPassword%2CresetNewPassword%2CauthenticatePasswordInAllStatus%2CbindThirdPartyToUserByPassprot%2CgetOrBindThirdUser%2CbatchAddUser%2CunbindUserFromThirdParty%2CresetPasswordInAllStatus%2CmodifyEmailInAllStatus%2CdeactivatedUser%2CgetUserByMobile%2ClistUserByUserIds%2CgetUserAndThirdAccounts%2CqueryUserStatusByAccount%2CaddUserByCheckAllStatus%2CconfirmUserOperation%2CgetUserByAccountInAllStatus%2ClistDeactivatedUser%2CgetUserByEmail%2CauthenticatePassword%2CconfirmDeleteUserData%2CmodifyUserStatusAndEmailStatus%2CmodifyIdentityInfo%2CmodifyUserInAllStatus%26owner%3Doneplus%26pid%3D36%26protocol%3Dhessian%26proxy%3DrouteJdk%26reference.filter%3DlogConsumerFilter%2Cdefault%2C%26release%3D2.7.4.1-SNAPSHOT%26revision%3D4.1.0-SNAPSHOT%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D60000%26timestamp%3D1618912845713%26version%3D4.0.0"]}
str;
    $res = UtilsHelper::parseServiceConfig($config);
    echo json_encode($res);exit;
}

/**
 * 解析provider测试
 */
function testFormatProvider()
{
    $provider = <<<str
hessian://10.130.71.2:10882/com.oneplus.user.api.UserFacade?anyhost=true&application=user-service&bean.name=com.oneplus.user.api.UserFacade&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&group=in&interface=com.oneplus.user.api.UserFacade&loadbalance=random&methods=resetPassword,unbindThirdUser,getUserByThirdParty,modifyPassword,getOrAddGetUserByUnionType,modifyMobileEmailPassowrd,modifyEmail,modifyMobileInAllStatus,addUser,getUserByAccount,activeModifiedEmail,isUserExisted,modifyUser,getThirdUser,addUserByMobileAndThirdParty,unbindMobile,bindThirdUser,recoverUser,modifyMobileForced,listUserIdByUserQuery,isUserExistedInAllStatus,recoverAndLogin,bindThirdPartyToUser,modifyMobile,modifyEmailByPassword,resetNewPassword,authenticatePasswordInAllStatus,bindThirdPartyToUserByPassprot,getOrBindThirdUser,batchAddUser,unbindUserFromThirdParty,resetPasswordInAllStatus,modifyEmailInAllStatus,deactivatedUser,getUserByMobile,listUserByUserIds,getUserAndThirdAccounts,queryUserStatusByAccount,confirmUserOperation,addUserByCheckAllStatus,getUserByAccountInAllStatus,listDeactivatedUser,getUserByEmail,authenticatePassword,confirmDeleteUserData,modifyUserStatusAndEmailStatus,modifyIdentityInfo,modifyUserInAllStatus&owner=oneplus&pid=536&release=2.7.4.1-SNAPSHOT&retries=0&revision=4.1.0-SNAPSHOT&service.filter=default,logProviderFilter,securityProviderFilter&side=provider&timeout=60000&timestamp=1618906425798&version=4.0.0
str;
    setOptions();
    $provider = UtilsHelper::formatProvider($provider);
    var_dump($provider);exit;
}

/**
 * 设置选项
 */
function setOptions()
{
    //设置选项
    UtilsHelper::setOption('version', '4.0.0');
    UtilsHelper::setOption('group', '');
    //超时时间
    UtilsHelper::setOption('connectTimeout', 2);
    UtilsHelper::setOption('executeTimeout', 5);
    UtilsHelper::setOption('dubbo', '2.5.3.1-SNAPSHOT');
    UtilsHelper::setOption('loadbalance', 'random');
    UtilsHelper::setOption('owner', 'php');
    //pid
    UtilsHelper::setOption('pid', 4536);
    UtilsHelper::setOption('protocol', 'http');
    UtilsHelper::setOption('side', 'consumer');
}

/**
 * GeoIP测试
 */
function testGeoIp()
{
//    $ip = "27.159.237.36"; // Putian
//    $ip = "14.215.177.38"; // Guangzhou
//    $ip = "58.60.185.11"; // Shenzhen
//    $ip = "39.99.228.188"; // Hangzhou
    $ip = "128.101.101.101"; // 美国 明尼苏达州 明尼阿波利斯
    // geoip文件夹请至百度网盘下载
    $mmdbFile = ROOT_PATH. '/geoip/GeoIP2-City.mmdb';
    $reader = new Reader($mmdbFile);
    $record = $reader->city($ip);
    print("国家简码：" . $record->country->isoCode . "\n");
    print("国家编码：" . $record->country->name . "\n");
    print("国家编码(zh-cn)：" . $record->country->names['zh-CN'] . "\n");
    print("provinceCode：" . $record->mostSpecificSubdivision->isoCode . "\n");
    print("province：" . $record->mostSpecificSubdivision->name . "\n");
    print("province(zh-cn)：" . $record->mostSpecificSubdivision->names['zh-CN'] . "\n");
    print("city：" . $record->city->name . "\n");
    print("city(zh-cn)：" . $record->city->names['zh-CN'] . "\n");
    print("经度：" . $record->location->longitude . "\n");
    print("纬度：" . $record->location->latitude . "\n");

//    var_dump($record->city);
    exit;
}